function mostrarAlerta(t,e){const r=document.createElement("div");r.className=`alerta ${t}`,r.setAttribute("data-temporizador",""),r.textContent=e,document.body.appendChild(r),setTimeout(()=>{r.classList.add("fade-out"),setTimeout(()=>{r.remove()},500)},5e3)}function agregarAlCarrito(t){fetch("/carrito/agregar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id="+encodeURIComponent(t)}).then(t=>t.json()).then(t=>{t.success?(mostrarAlerta("exito",t.message),document.querySelector(".carrito").classList.contains("mostrar")&&cargarCarrito()):mostrarAlerta("error",t.message)}).catch(t=>{mostrarAlerta("error","Error al agregar al carrito")})}function cargarCarrito(){fetch("/carrito/ver").then(t=>t.text()).then(t=>{document.getElementById("carrito-contenido").innerHTML=t,agregarEventListenersCarrito()}).catch(t=>{console.error("Error:",t)})}function agregarEventListenersCarrito(){document.querySelectorAll(".btn-menos").forEach(t=>{t.addEventListener("click",function(){const t=this.closest(".carrito-item"),e=t.getAttribute("data-clave"),r=t.querySelector(".cantidad");let a=parseInt(r.textContent);a>1&&(a--,actualizarCantidad(e,a))})}),document.querySelectorAll(".btn-mas").forEach(t=>{t.addEventListener("click",function(){const t=this.closest(".carrito-item"),e=t.getAttribute("data-clave"),r=t.querySelector(".cantidad");let a=parseInt(r.textContent);a++,actualizarCantidad(e,a)})}),document.querySelectorAll(".btn-eliminar").forEach(t=>{t.addEventListener("click",function(){eliminarDelCarrito(this.closest(".carrito-item").getAttribute("data-clave"))})});const t=document.querySelector("#closeCarrito");t&&t.addEventListener("click",function(){document.querySelector(".carrito").classList.remove("mostrar")}),document.addEventListener("click",function(t){t.target.classList.contains("btn-comprar")&&(window.location.href="/checkout")})}function actualizarCantidad(t,e){fetch("/carrito/actualizar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"clave="+encodeURIComponent(t)+"&cantidad="+encodeURIComponent(e)}).then(t=>t.json()).then(t=>{t.success?cargarCarrito():mostrarAlerta("error",t.message)}).catch(t=>{mostrarAlerta("error","Error al actualizar cantidad")})}function eliminarDelCarrito(t){fetch("/carrito/eliminar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"clave="+encodeURIComponent(t)}).then(t=>t.json()).then(t=>{t.success?cargarCarrito():mostrarAlerta("error",t.message)}).catch(t=>{mostrarAlerta("error","Error al eliminar producto")})}document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".carrito-icon"),e=document.querySelector(".carrito");t&&t.addEventListener("click",function(t){t.stopPropagation(),e.classList.toggle("mostrar"),e.classList.contains("mostrar")&&cargarCarrito()}),document.addEventListener("click",function(r){e.contains(r.target)||t.contains(r.target)||e.classList.remove("mostrar")});const r=document.querySelector("#user-icon"),a=document.querySelector("#user-dropdown");r&&a&&(r.addEventListener("click",function(t){t.stopPropagation(),a.classList.toggle("mostrar")}),document.addEventListener("click",function(t){a.contains(t.target)||r.contains(t.target)||a.classList.remove("mostrar")}));const o=document.querySelector(".mobile-menu"),n=document.querySelector(".navegacion-principal");o&&n&&(o.addEventListener("click",function(t){t.stopPropagation(),n.classList.toggle("mostrar")}),document.addEventListener("click",function(t){n.contains(t.target)||o.contains(t.target)||n.classList.remove("mostrar")})),document.addEventListener("click",function(t){if(t.target.classList.contains("agregar-carrito")){t.preventDefault();agregarAlCarrito(t.target.getAttribute("data-id"))}})});