function agregarAlCarrito(t){fetch("/carrito/agregar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id="+encodeURIComponent(t)}).then(t=>t.json()).then(t=>{t.success?(alert(t.message),document.querySelector(".carrito").classList.contains("mostrar")&&cargarCarrito()):alert(t.message)}).catch(t=>{console.error("Error:",t),alert("Error al agregar al carrito")})}function cargarCarrito(){fetch("/carrito/ver").then(t=>t.text()).then(t=>{document.getElementById("carrito-contenido").innerHTML=t,agregarEventListenersCarrito()}).catch(t=>{console.error("Error:",t)})}function agregarEventListenersCarrito(){document.querySelectorAll(".btn-menos").forEach(t=>{t.addEventListener("click",function(){const t=this.closest(".carrito-item"),e=t.getAttribute("data-id"),r=t.querySelector(".cantidad");let o=parseInt(r.textContent);o>1&&(o--,actualizarCantidad(e,o))})}),document.querySelectorAll(".btn-mas").forEach(t=>{t.addEventListener("click",function(){const t=this.closest(".carrito-item"),e=t.getAttribute("data-id"),r=t.querySelector(".cantidad");let o=parseInt(r.textContent);o++,actualizarCantidad(e,o)})}),document.querySelectorAll(".btn-eliminar").forEach(t=>{t.addEventListener("click",function(){eliminarDelCarrito(this.closest(".carrito-item").getAttribute("data-id"))})});const t=document.querySelector("#closeCarrito");t&&t.addEventListener("click",function(){document.querySelector(".carrito").classList.remove("mostrar")}),document.addEventListener("click",function(t){t.target.classList.contains("btn-comprar")&&(window.location.href="/checkout")})}function actualizarCantidad(t,e){fetch("/carrito/actualizar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id="+encodeURIComponent(t)+"&cantidad="+encodeURIComponent(e)}).then(t=>t.json()).then(t=>{t.success?cargarCarrito():alert(t.message)}).catch(t=>{console.error("Error:",t),alert("Error al actualizar cantidad")})}function eliminarDelCarrito(t){fetch("/carrito/eliminar",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:"id="+encodeURIComponent(t)}).then(t=>t.json()).then(t=>{t.success?cargarCarrito():alert(t.message)}).catch(t=>{console.error("Error:",t),alert("Error al eliminar producto")})}document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".carrito-icon"),e=document.querySelector(".carrito");t&&t.addEventListener("click",function(t){t.stopPropagation(),e.classList.toggle("mostrar"),e.classList.contains("mostrar")&&cargarCarrito()}),document.addEventListener("click",function(r){e.contains(r.target)||t.contains(r.target)||e.classList.remove("mostrar")});const r=document.querySelector("#user-icon"),o=document.querySelector("#user-dropdown");r&&o&&(r.addEventListener("click",function(t){t.stopPropagation(),o.classList.toggle("mostrar")}),document.addEventListener("click",function(t){o.contains(t.target)||r.contains(t.target)||o.classList.remove("mostrar")})),document.addEventListener("click",function(t){if(t.target.classList.contains("agregar-carrito")){t.preventDefault();agregarAlCarrito(t.target.getAttribute("data-id"))}})});